import{f as M,g as U,M as A,o as _,c as h,a as t,h as z,i as k,d as P,j as S,u as a,F as R,k as T,b as y,v as w,l as E,_ as j,m as V,n as $,p as C,q as B,s as H,x as G,y as J,r as K,e as O,t as Q,z as W}from"./index-c02279fb.js";const X={class:"modal-dialog"},Y={class:"modal-content border-0"},Z=t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")],-1),tt={class:"modal-body"},et={class:"text-danger"},ot={__name:"DeleteProductModal",props:["tempProduct"],emits:["update"],setup(s,{expose:b,emit:f}){const r=s,u=M();let n=null;U(()=>{n=new A(u.value,{keyboard:!1,backdrop:!1})});const o=async()=>{const e=`https://vue3-course-api.hexschool.io/v2/api/tuhacrt/admin/product/${r.tempProduct.id}`;try{const p=await P.delete(e);alert(p.data.message),d(),f("update")}catch(p){alert(p.response.data.message)}},i=()=>n==null?void 0:n.show(),d=()=>n==null?void 0:n.hide();return b({delProductModalRef:u,deleteProduct:o,showModal:i,hideModal:d}),(e,p)=>{var m;return _(),h("div",{id:"delProductModal",ref_key:"delProductModalRef",ref:u,class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},[t("div",X,[t("div",Y,[t("div",{class:"modal-header bg-danger text-white"},[Z,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:d})]),t("div",tt,[z(" 是否刪除 "),t("strong",et,k((m=s.tempProduct)==null?void 0:m.title),1),z(" 商品(刪除後將無法恢復)。 ")]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:d}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:o}," 確認刪除 ")])])])],512)}}},st={class:"modal-dialog modal-xl"},at={class:"modal-content"},nt={class:"modal-header bg-dark text-white"},lt={id:"productModalLabel",class:"modal-title"},it={class:"modal-body"},dt={class:"row"},ct={key:0,class:"col-sm-4"},rt={class:"mb-3"},pt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),ut=["onUpdate:modelValue"],mt=["src"],_t={key:0},ht={key:1},bt={key:1},gt={class:"col-sm-8"},ft={class:"mb-3"},vt=t("label",{for:"title",class:"form-label"},"標題",-1),yt={class:"row"},wt={class:"mb-3 col-md-6"},kt=t("label",{for:"category",class:"form-label"},"分類",-1),Mt={class:"mb-3 col-md-6"},Pt=t("label",{for:"price",class:"form-label"},"單位",-1),xt={class:"row"},$t={class:"mb-3 col-md-6"},Ct=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Ut={class:"mb-3 col-md-6"},Rt=t("label",{for:"price",class:"form-label"},"售價",-1),Vt=t("hr",null,null,-1),Nt={class:"mb-3"},Lt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Dt={class:"mb-3"},It=t("label",{for:"content",class:"form-label"},"說明內容",-1),zt={class:"mb-3"},Bt={class:"form-check"},At=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),St={__name:"ProductModal",props:["tempProduct","isNew"],emits:["update"],setup(s,{expose:b,emit:f}){const r=s,u=M();let n=null;const o=S(r,"tempProduct");U(()=>{n=new A(u.value,{keyboard:!1,backdrop:!1})});const i=async()=>{try{const[g,l]=d(),x=await P[l](g,{data:o==null?void 0:o.value});alert(x.data.message),m(),f("update")}catch(g){alert(g.response.data.message)}},d=()=>{const g="https://vue3-course-api.hexschool.io/v2/api/tuhacrt/admin/product";return r.isNew?[g,"post"]:[`${g}/${r.tempProduct.id}`,"put"]},e=()=>o.value.imagesUrl=[""],p=()=>n==null?void 0:n.show(),m=()=>n==null?void 0:n.hide();return b({productModalRef:u,localTempProduct:o,updateProduct:i,createImages:e,showModal:p,hideModal:m}),(g,l)=>{var x,N,L,D,I;return _(),h("div",{id:"productModal",ref_key:"productModalRef",ref:u,class:"modal fade border-0",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[t("div",st,[t("div",at,[t("div",nt,[t("h5",lt,[t("span",null,k(s.isNew?"新增產品":"編輯產品"),1)]),t("button",{type:"button",class:"btn-close",onClick:m,"aria-label":"Close"})]),t("div",it,[t("div",dt,[Array.isArray((x=a(o))==null?void 0:x.imagesUrl)?(_(),h("div",ct,[(_(!0),h(R,null,T((N=a(o))==null?void 0:N.imagesUrl,(c,v)=>(_(),h("div",{key:v},[t("div",rt,[pt,y(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":q=>a(o).imagesUrl[v]=q},null,8,ut),[[w,a(o).imagesUrl[v]]])]),t("img",{class:"img-fluid mb-2",src:c},null,8,mt)]))),128)),!((L=a(o))!=null&&L.imagesUrl.length)||(I=a(o))!=null&&I.imagesUrl[((D=a(o))==null?void 0:D.imagesUrl.length)-1]?(_(),h("div",_t,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:l[0]||(l[0]=c=>{var v;return(v=a(o))==null?void 0:v.imagesUrl.push("")})}," 新增圖片 ")])):(_(),h("div",ht,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:l[1]||(l[1]=c=>{var v;return(v=a(o))==null?void 0:v.imagesUrl.pop()})}," 刪除圖片 ")]))])):(_(),h("div",bt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e}," 新增圖片 ")])),t("div",gt,[t("div",ft,[vt,y(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":l[2]||(l[2]=c=>a(o).title=c)},null,512),[[w,a(o).title]])]),t("div",yt,[t("div",wt,[kt,y(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":l[3]||(l[3]=c=>a(o).category=c)},null,512),[[w,a(o).category]])]),t("div",Mt,[Pt,y(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":l[4]||(l[4]=c=>a(o).unit=c)},null,512),[[w,a(o).unit]])])]),t("div",xt,[t("div",$t,[Ct,y(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":l[5]||(l[5]=c=>a(o).origin_price=c)},null,512),[[w,a(o).origin_price]])]),t("div",Ut,[Rt,y(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":l[6]||(l[6]=c=>a(o).price=c)},null,512),[[w,a(o).price]])])]),Vt,t("div",Nt,[Lt,y(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":l[7]||(l[7]=c=>a(o).description=c)},`
                `,512),[[w,a(o).description]])]),t("div",Dt,[It,y(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":l[8]||(l[8]=c=>a(o).content=c)},`
                `,512),[[w,a(o).content]])]),t("div",zt,[t("div",Bt,[y(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=c=>a(o).is_enabled=c),"true-value":1,"false-value":0},null,512),[[E,a(o).is_enabled]]),At])])])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:m}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:i}," 確認 ")])])])],512)}}};const F=s=>(G("data-v-5643b52f"),s=s(),J(),s),Tt=F(()=>t("span",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#0d6efd",width:"14",height:"14",viewBox:"0 0 24 24"},[t("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1)),jt=F(()=>t("span",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#0d6efd",width:"14",height:"14",viewBox:"0 0 24 24"},[t("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1)),Ft={__name:"PaginationComponent",props:["pagination"],emits:["changePage"],setup(s,{expose:b,emit:f}){const r=s,u=M(),n=S(r,"pagination"),o=V(()=>{var e;return((e=n==null?void 0:n.value)==null?void 0:e.total_pages)*10});let i=M(1);U(()=>{});const d=e=>{f("changePage",e)};return b({paginationComponentRef:u,localPagination:n,totalItems:o,currentPage:i,onClickHandler:d}),(e,p)=>{const m=$("vue-awesome-paginate");return _(),h("div",{class:"pagination-component",ref_key:"paginationComponentRef",ref:u},[C(m,{"total-items":a(o),"item-per-page":10,modelValue:a(i),"onUpdate:modelValue":p[0]||(p[0]=g=>H(i)?i.value=g:i=g),"on-click":d},{"prev-button":B(()=>[Tt]),"next-button":B(()=>[jt]),_:1},8,["total-items","modelValue"])],512)}}},qt=j(Ft,[["__scopeId","data-v-5643b52f"]]),Et={components:{DelProductModal:ot,ProductModal:St,PaginationComponent:qt},setup(){const s=K({delProductModalRef:M(),productModalRef:M(),paginationComponentRef:M(),products:[],tempProduct:{imagesUrl:[]},isNew:!1,pagination:{}}),b=V(()=>s.delProductModalRef),f=V(()=>s.productModalRef);U(()=>{r("loginToken"),u()});const r=i=>{const e=`; ${document.cookie}`.split(`; ${i}=`),p=e.length===2?e.pop().split(";").shift():"";P.defaults.headers.common.Authorization=p},u=async()=>{const i="https://vue3-course-api.hexschool.io/v2/api/user/check";try{await P.post(i),n()}catch(d){alert(d.response.data.message),O.push("/")}},n=async(i=s.pagination.current_page||1)=>{console.log(`getting update with ${i}`);const d=`https://vue3-course-api.hexschool.io/v2/api/tuhacrt/admin/products/?page=${i}`;try{const e=await P.get(d);s.products=e.data.products,s.pagination=e.data.pagination}catch(e){alert(e.response.data.message)}},o=(i,d)=>{var e,p,m;switch(i){case"new":s.tempProduct={imageUrl:[]},s.isNew=!0,(e=f.value)==null||e.showModal();break;case"edit":s.tempProduct={...d},s.isNew=!1,(p=f.value)==null||p.showModal();break;case"delete":s.tempProduct={...d},(m=b.value)==null||m.showModal();break}};return{...Q(s),getProductList:n,openModal:o}}},Ht={class:"container"},Gt={class:"text-end mt-4"},Jt={class:"table mt-4"},Kt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Ot={class:"text-end"},Qt={class:"text-end"},Wt={class:"btn-group"},Xt=["onClick"],Yt=["onClick"],Zt={class:"d-flex justify-content-center"};function te(s,b,f,r,u,n){const o=$("PaginationComponent"),i=$("ProductModal"),d=$("DelProductModal");return _(),h(R,null,[t("div",Ht,[t("div",Gt,[t("button",{class:"btn btn-primary",onClick:b[0]||(b[0]=e=>r.openModal("new"))}," 建立新的產品 ")]),t("table",Jt,[Kt,(_(!0),h(R,null,T(s.products,e=>(_(),h("tbody",{key:e==null?void 0:e.id},[t("tr",null,[t("td",null,k(e==null?void 0:e.category),1),t("td",null,k(e==null?void 0:e.title),1),t("td",Ot,k(e==null?void 0:e.origin_price),1),t("td",Qt,k(e==null?void 0:e.price),1),t("td",null,[t("span",{class:W({"text-success":e==null?void 0:e.is_enabled})},k(e!=null&&e.is_enabled?"啟用":"未啟用"),3)]),t("td",null,[t("div",Wt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:p=>r.openModal("edit",e)}," 編輯 ",8,Xt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>r.openModal("delete",e)}," 刪除 ",8,Yt)])])])]))),128))]),t("div",Zt,[C(o,{pagination:s.pagination,onChangePage:r.getProductList,ref:"paginationComponentRef"},null,8,["pagination","onChangePage"])])]),C(i,{"temp-product":s.tempProduct,"is-new":s.isNew,onUpdate:r.getProductList,ref:"productModalRef"},null,8,["temp-product","is-new","onUpdate"]),C(d,{"temp-product":s.tempProduct,onUpdate:r.getProductList,ref:"delProductModalRef"},null,8,["temp-product","onUpdate"])],64)}const oe=j(Et,[["render",te]]);export{oe as default};
