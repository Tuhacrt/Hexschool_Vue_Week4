import{f as M,g as C,M as A,o as h,c as b,a as t,h as I,i as P,d as V,j as N,u as a,F as E,k as H,b as y,v as w,l as O,m as T,n as U,p as $,q as D,s as z,_ as S,r as W,e as X,t as j,x as q,y as F}from"./index-5a11dad7.js";const G={class:"modal-dialog"},J={class:"modal-content border-0"},K=t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")],-1),Q={class:"modal-body"},Y={class:"text-danger"},Z={__name:"DeleteProductModal",props:["tempProduct"],emits:["update"],setup(s,{expose:g,emit:f}){const u=s,m=M();let i=null;C(()=>{i=new A(m.value,{keyboard:!1,backdrop:!1})});const e=async()=>{const{VITE_URL:d,VITE_PATH:n}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week4/",MODE:"production",DEV:!1,PROD:!0},l=`${d}/api/${n}/admin/product/${u.tempProduct.id}`;try{const r=await V.delete(l);alert(r.data.message),_(),f("update")}catch(r){alert(r.response.data.message)}},p=()=>i==null?void 0:i.show(),_=()=>i==null?void 0:i.hide();return g({deleteProductModalRef:m,deleteProduct:e,showModal:p,hideModal:_}),(d,n)=>{var l;return h(),b("div",{id:"deleteProductModal",ref_key:"deleteProductModalRef",ref:m,class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},[t("div",G,[t("div",J,[t("div",{class:"modal-header bg-danger text-white"},[K,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:_})]),t("div",Q,[I(" 是否刪除 "),t("strong",Y,P((l=s.tempProduct)==null?void 0:l.title),1),I(" 商品(刪除後將無法恢復)。 ")]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:_}," 取消 "),t("button",{type:"button",class:"btn btn-danger",onClick:e}," 確認刪除 ")])])])],512)}}},tt={class:"modal-dialog modal-xl"},et={class:"modal-content"},ot={class:"modal-header bg-dark text-white"},st={id:"productModalLabel",class:"modal-title"},nt={class:"modal-body"},at={class:"row"},lt={key:0,class:"col-sm-4"},it={class:"mb-3"},dt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),ct=["onUpdate:modelValue"],rt=["src"],ut={key:0},pt={key:1},mt={key:1},_t={class:"col-sm-8"},ht={class:"mb-3"},bt=t("label",{for:"title",class:"form-label"},"標題",-1),gt={class:"row"},ft={class:"mb-3 col-md-6"},vt=t("label",{for:"category",class:"form-label"},"分類",-1),yt={class:"mb-3 col-md-6"},wt=t("label",{for:"price",class:"form-label"},"單位",-1),kt={class:"row"},Pt={class:"mb-3 col-md-6"},Mt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Vt={class:"mb-3 col-md-6"},xt=t("label",{for:"price",class:"form-label"},"售價",-1),Ut=t("hr",null,null,-1),$t={class:"mb-3"},Ct=t("label",{for:"description",class:"form-label"},"產品描述",-1),Rt={class:"mb-3"},Et=t("label",{for:"content",class:"form-label"},"說明內容",-1),Tt={class:"mb-3"},Lt={class:"form-check"},It=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Dt={__name:"ProductModal",props:["tempProduct","isNew"],emits:["update"],setup(s,{expose:g,emit:f}){const u=s,m=M();let i=null;const e=N(u,"tempProduct");C(()=>{i=new A(m.value,{keyboard:!1,backdrop:!1})});const p=async()=>{try{const{method:r,url:o}=_(),k=await V[r](o,{data:e==null?void 0:e.value});alert(k.data.message),l(),f("update")}catch(r){alert(r.response.data.message)}},_=()=>{const{VITE_URL:r,VITE_PATH:o}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week4/",MODE:"production",DEV:!1,PROD:!0},k=`${r}/api/${o}/admin/product`,x=u.isNew?k:`${k}/${e.value.id}`;return{method:u.isNew?"post":"put",url:x}},d=()=>e.value.imagesUrl=[""],n=()=>i==null?void 0:i.show(),l=()=>i==null?void 0:i.hide();return g({productModalRef:m,productData:e,updateProduct:p,initializeProductImages:d,showModal:n,hideModal:l}),(r,o)=>{var k,x,R,L;return h(),b("div",{id:"productModal",ref_key:"productModalRef",ref:m,class:"modal fade border-0",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},[t("div",tt,[t("div",et,[t("div",ot,[t("h5",st,[t("span",null,P(s.isNew?"新增產品":"編輯產品"),1)]),t("button",{type:"button",class:"btn-close",onClick:l,"aria-label":"Close"})]),t("div",nt,[t("div",at,[Array.isArray((k=a(e))==null?void 0:k.imagesUrl)?(h(),b("div",lt,[(h(!0),b(E,null,H((x=a(e))==null?void 0:x.imagesUrl,(c,v)=>(h(),b("div",{key:v},[t("div",it,[dt,y(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":B=>a(e).imagesUrl[v]=B},null,8,ct),[[w,a(e).imagesUrl[v]]])]),t("img",{class:"img-fluid mb-2",src:c},null,8,rt)]))),128)),((L=a(e))==null?void 0:L.imagesUrl[((R=a(e))==null?void 0:R.imagesUrl.length)-1])!==""?(h(),b("div",ut,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:o[0]||(o[0]=c=>{var v;return(v=a(e))==null?void 0:v.imagesUrl.push("")})}," 新增圖片 ")])):(h(),b("div",pt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:o[1]||(o[1]=c=>{var v;return(v=a(e))==null?void 0:v.imagesUrl.pop()})}," 刪除圖片 ")]))])):(h(),b("div",mt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:d}," 新增圖片 ")])),t("div",_t,[t("div",ht,[bt,y(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[2]||(o[2]=c=>a(e).title=c)},null,512),[[w,a(e).title]])]),t("div",gt,[t("div",ft,[vt,y(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":o[3]||(o[3]=c=>a(e).category=c)},null,512),[[w,a(e).category]])]),t("div",yt,[wt,y(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":o[4]||(o[4]=c=>a(e).unit=c)},null,512),[[w,a(e).unit]])])]),t("div",kt,[t("div",Pt,[Mt,y(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":o[5]||(o[5]=c=>a(e).origin_price=c)},null,512),[[w,a(e).origin_price]])]),t("div",Vt,[xt,y(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":o[6]||(o[6]=c=>a(e).price=c)},null,512),[[w,a(e).price]])])]),Ut,t("div",$t,[Ct,y(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":o[7]||(o[7]=c=>a(e).description=c)},`
                `,512),[[w,a(e).description]])]),t("div",Rt,[Et,y(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":o[8]||(o[8]=c=>a(e).content=c)},`
                `,512),[[w,a(e).content]])]),t("div",Tt,[t("div",Lt,[y(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[9]||(o[9]=c=>a(e).is_enabled=c),"true-value":1,"false-value":0},null,512),[[O,a(e).is_enabled]]),It])])])])]),t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:l}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:p}," 確認 ")])])])],512)}}};const At=t("span",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#0d6efd",width:"14",height:"14",viewBox:"0 0 24 24"},[t("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1),Nt=t("span",null,[t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#0d6efd",width:"14",height:"14",viewBox:"0 0 24 24"},[t("path",{d:"M8.122 24l-4.122-4 8-8-8-8 4.122-4 11.878 12z"})])],-1),Ht={__name:"PaginationComponent",props:["pagination"],emits:["changePage"],setup(s,{expose:g,emit:f}){const u=s,m=M(),i=N(u,"pagination"),e=T(()=>(i==null?void 0:i.value.total_pages)*10);let p=M(1);C(()=>{});const _=d=>{f("changePage",d)};return g({paginationComponentRef:m,localPagination:i,totalItems:e,currentPage:p,onClickPage:_}),(d,n)=>{const l=U("vue-awesome-paginate");return h(),b("div",{class:"pagination-component",ref_key:"paginationComponentRef",ref:m},[$(l,{"total-items":a(e),"item-per-page":10,modelValue:a(p),"onUpdate:modelValue":n[0]||(n[0]=r=>z(p)?p.value=r:p=r),"on-click":_},{"prev-button":D(()=>[At]),"next-button":D(()=>[Nt]),_:1},8,["total-items","modelValue"])],512)}}},Bt={components:{DeleteProductModal:Z,ProductModal:Dt,PaginationComponent:Ht},setup(){const s=W({deleteProductModalRef:M(),productModalRef:M(),paginationComponentRef:M(),products:[],tempProduct:{imagesUrl:[]},isNew:!1,pagination:{}}),g=T(()=>s.deleteProductModalRef),f=T(()=>s.productModalRef),{VITE_URL:u,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"tuhacrt",VITE_TEXT:"Environment is in production build",BASE_URL:"/Hexschool_Vue_Week4/",MODE:"production",DEV:!1,PROD:!0};C(()=>{i("loginToken"),e()});const i=d=>{const l=`; ${document.cookie}`.split(`; ${d}=`),r=l.length===2?l.pop().split(";").shift():"";V.defaults.headers.common.Authorization=r},e=async()=>{const d=`${u}/api/user/check`;try{await V.post(d),p()}catch(n){alert(n.response.data.message),X.push("/")}},p=async(d=s.pagination.current_page||1)=>{console.log(`getting update with ${d}`);const n=`${u}/api/${m}/admin/products/?page=${d}`;try{const l=await V.get(n);s.products=l.data.products,s.pagination=l.data.pagination}catch(l){alert(l.response.data.message)}},_=(d,n)=>{var l,r,o;switch(d){case"new":s.tempProduct={imageUrl:[]},s.isNew=!0,(l=f.value)==null||l.showModal();break;case"edit":s.tempProduct={...n},s.isNew=!1,(r=f.value)==null||r.showModal();break;case"delete":s.tempProduct={...n},(o=g.value)==null||o.showModal();break}};return{...j(s),getProductList:p,openModal:_}}},Ot={class:"container"},zt={class:"text-end mt-4"},St={class:"table mt-4"},Wt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Xt={key:0},jt={class:"text-end"},qt={class:"text-end"},Ft={class:"btn-group"},Gt=["onClick"],Jt=["onClick"],Kt={class:"d-flex justify-content-center"};function Qt(s,g,f,u,m,i){var d;const e=U("PaginationComponent"),p=U("ProductModal"),_=U("DeleteProductModal");return h(),b(E,null,[t("div",Ot,[t("div",zt,[t("button",{class:"btn btn-primary",onClick:g[0]||(g[0]=n=>u.openModal("new"))}," 建立新的產品 ")]),t("table",St,[Wt,(d=s.products)!=null&&d.length?(h(),b("tbody",Xt,[(h(!0),b(E,null,H(s.products,n=>(h(),b("tr",{key:n.id},[t("td",null,P(n.category),1),t("td",null,P(n.title),1),t("td",jt,P(n.origin_price),1),t("td",qt,P(n.price),1),t("td",null,[t("span",{class:F({"text-success":n.is_enabled})},P(n.is_enabled?"啟用":"未啟用"),3)]),t("td",null,[t("div",Ft,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:l=>u.openModal("edit",n)}," 編輯 ",8,Gt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:l=>u.openModal("delete",n)}," 刪除 ",8,Jt)])])]))),128))])):q("",!0)]),t("div",Kt,[$(e,{pagination:s.pagination,onChangePage:u.getProductList,ref:"paginationComponentRef"},null,8,["pagination","onChangePage"])])]),$(p,{"temp-product":s.tempProduct,"is-new":s.isNew,onUpdate:u.getProductList,ref:"productModalRef"},null,8,["temp-product","is-new","onUpdate"]),$(_,{"temp-product":s.tempProduct,onUpdate:u.getProductList,ref:"deleteProductModalRef"},null,8,["temp-product","onUpdate"])],64)}const Zt=S(Bt,[["render",Qt]]);export{Zt as default};
